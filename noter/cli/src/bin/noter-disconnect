#!/usr/bin/python
# -*- coding: utf-8 -*-

# Standard modules.
import sys

# Project modules.
import noter.cli
import noter.core
import noter.daemon

USAGE = '%prog [OPTION]... DIRPATH'

DESCRIPTION = '''Requests noter-daemon to
disconnect a device pointed by a path to a sysfs device directory.'''

def parse_args():
    parser = noter.core.OptionParser(usage=USAGE,
                                     description=DESCRIPTION)
    parser.add_option("--list-connected", "", action="store_true",
                      help="List all connected devices and exit.")
    parser.add_option("--list-all", "", action="store_true",
                      help="List all devices and exit.")
    parser.add_option("--all", "", action="store_true",
                      help="Disconnect all connected devices.")
    return parser.parse_args(sys.argv)

if __name__ == "__main__":
    options, args = parse_args()

    daemon = noter.daemon.Interface()

    connected_devs = daemon.connected_devices()
    disconnected_devs = list(daemon.disconnected_devices())

    if options.list_all:
        noter.cli.print_connected_devices(connected_devs)
        noter.cli.print_disconnected_devices(disconnected_devs)
        sys.exit(0)

    if options.list_connected:
        noter.cli.print_connected_devices(connected_devs)
        sys.exit(0)

    if options.all:
        for dirpath in connected_devs:
            daemon.disconnect(dirpath)
        sys.exit(0)

    daemon.disconnect(args[1])
