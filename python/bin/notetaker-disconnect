#!/usr/bin/python
# -*- coding: utf-8 -*-

# Standard modules.
import optparse
import sys

# Project modules.
import notetaker

def parse_args():
    parser = optparse.OptionParser(version='''%prog 0.1
Copyright (C) 2010 Tuomas (tuos) R채s채nen <tuos@codegrove.org>
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Tuomas R채s채nen.''',
                                   usage='%prog [OPTION]... DIRPATH',
                                   description='''Requests notetakerd to
disconnect a device pointed by a path to a sysfs device directory.''')
    parser.add_option("--list-connected", "", action="store_true",
                      help="List all connected devices and exit.")
    parser.add_option("--list-all", "", action="store_true",
                      help="List all devices and exit.")
    parser.add_option("--all", "", action="store_true",
                      help="Disconnect all connected devices.")
    return parser.parse_args(sys.argv)

if __name__ == "__main__":
    options, args = parse_args()

    daemon = notetaker.Daemon()

    connected_devs = daemon.connected_devices()
    disconnected_devs = daemon.disconnected_devices()

    if options.list_all:
        options.list_connected = True
        for dirpath in disconnected_devs:
            print "D", dirpath

    if options.list_connected:
        for dirpath in connected_devs:
            print "C", dirpath
        sys.exit(0)

    if options.all:
        for dirpath in connected_devs:
            daemon.disconnect(dirpath)
        sys.exit(0)

    daemon.disconnect(args[1])
