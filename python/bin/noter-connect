#!/usr/bin/python
# -*- coding: utf-8 -*-

# Standard modules.
import sys

# Project modules.
import noter
import noter.cli

USAGE = '%prog [OPTION]... DIRPATH'
DESCRIPTION = '''Requests noter-daemon to
connect a device pointed by a path to a sysfs device directory.'''

def parse_args():
    parser = noter.cli.OptionParser(usage=USAGE,
                                        description=DESCRIPTION)

    parser.add_option("--list-disconnected", "", action="store_true",
                      help="List all disconnected devices and exit.")
    parser.add_option("--list-all", "", action="store_true",
                      help="List all devices and exit.")
    parser.add_option("--all", "", action="store_true",
                      help="Connect all disconnected devices.")

    return parser.parse_args(sys.argv)

if __name__ == "__main__":
    options, args = parse_args()

    daemon = noter.Daemon()

    connected_devs = daemon.connected_devices()
    disconnected_devs = daemon.disconnected_devices()

    if options.list_all:
        noter.cli.print_connected_devices(connected_devs)
        noter.cli.print_disconnected_devices(disconnected_devs)
        sys.exit(0)

    if options.list_disconnected:
        noter.cli.print_disconnected_devices(disconnected_devs)
        sys.exit(0)

    if options.all:
        for dirpath in disconnected_devs:
            daemon.connect(dirpath)
        sys.exit(0)

    daemon.connect(args[1])
