#!/usr/bin/python
# -*- coding: utf-8 -*-

# Standard modules.
import optparse
import sys

# Project modules.
import notetaker

def parse_args():
    parser = optparse.OptionParser(version='''%prog 0.1
Copyright (C) 2010 Tuomas (tuos) R채s채nen <tuos@codegrove.org>
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Tuomas R채s채nen.''',
                                   usage='%prog [OPTION]... DIRPATH',
                                   description='''Requests notetakerd to
connect a device pointed by a path to a sysfs device directory.''')
    parser.add_option("--list", "", action="store_true",
                      help="List all disconnected devices and exit.")
    parser.add_option("--all", "", action="store_true",
                      help="Connect all disconnected devices.")
    return parser.parse_args(sys.argv)

if __name__ == "__main__":
    options, args = parse_args()

    daemon = notetaker.Daemon()

    if options.list:
        connections = daemon.connections()
        for dirpath in notetaker.find_m210_dirpaths():
            if dirpath not in connections:
                print dirpath
        sys.exit(0)

    if options.all:
        connections = daemon.connections()
        for dirpath in notetaker.find_m210_dirpaths():
            if dirpath not in connections:
                daemon.connect(dirpath)
        sys.exit(0)

    daemon.connect(args[1])
