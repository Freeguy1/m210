#!/usr/bin/python

import os
import os.path
import sys

import dbus

if __name__ == "__main__":
    syspath = sys.argv[1]
    filepath = "/sys" + syspath
    find_cmd = r"find %s -iregex .*%s[0-9][0-9]*$ | sed 's/.*\(%s[0-9][0-9]*\)/\1/'"
    find_hidraw = find_cmd % (filepath, "hidraw", "hidraw")
    find_event = find_cmd % (filepath, "event", "event")
    hidraw_names = os.popen(find_hidraw).read().strip().splitlines()
    hidraw0_path, hidraw1_path = ["/dev/" + name for name in hidraw_names]
    event_path = "/dev/input/" + os.popen(find_event).read().strip().splitlines()[0]
    
    bus = dbus.SystemBus()
    remote_object = bus.get_object('org.codegrove.notetaker',
                                   '/org/codegrove/notetaker/daemon')
    iface = dbus.Interface(remote_object, 'org.codegrove.notetaker.daemon')
    iface.connect(syspath, hidraw0_path, hidraw1_path, event_path)
