#!/usr/bin/python
# -*- coding: utf-8 -*-

# Standard modules.
import sys

# Project modules.
import notetaker
import notetaker.cli

USAGE = '%prog [OPTION]... DIRPATH'
DESCRIPTION = '''Requests notetakerd to
connect a device pointed by a path to a sysfs device directory.'''

def parse_args():
    parser = notetaker.cli.OptionParser(usage=USAGE,
                                        description=DESCRIPTION)

    parser.add_option("--list-disconnected", "", action="store_true",
                      help="List all disconnected devices and exit.")
    parser.add_option("--list-all", "", action="store_true",
                      help="List all devices and exit.")
    parser.add_option("--all", "", action="store_true",
                      help="Connect all disconnected devices.")

    return parser.parse_args(sys.argv)

if __name__ == "__main__":
    options, args = parse_args()

    daemon = notetaker.Daemon()

    connected_devs = daemon.connected_devices()
    disconnected_devs = daemon.disconnected_devices()

    if options.list_all:
        options.list_disconnected = True
        for dirpath in connected_devs:
            print "C", dirpath

    if options.list_disconnected:
        for dirpath in disconnected_devs:
            print "D", dirpath
        sys.exit(0)

    if options.all:
        for dirpath in disconnected_devs:
            daemon.connect(dirpath)
        sys.exit(0)

    daemon.connect(args[1])
